# PHP 5.6.x から PHP 7.0.x への移行

---

## PHPのバージョンアップに伴う移行

* PHP本家にも[ドキュメント](http://php.net/manual/ja/migration70.php)が用意されています。
> このリリースで主に注力したのは、これまでのバージョンで廃止予定とされていた機能の削除や、 言語としての一貫性の向上です。

* 新機能の追加などが主な内容ですが、今まで使えていた機能で使えなくなるものもあります。

* 本記事では、バージョンアップすることで使えなくなる、互換性がなくなるといった機能についてまとめます。


---

## 下位互換性のない変更点

* エラーや例外の取り扱いの変更
 * set_exception_handler() が常に Exception オブジェクトを受け取るとは限らない
 * 内部のコンストラクタは、失敗したときに常に例外をスローする
 * パースエラーが発生すると ParseError をスローする
 * E_STRICT 通知の深刻度の変更

* 変数の取り扱いの変更
 * 変数やプロパティ、メソッドへの間接的なアクセスの扱いの変更
   - 変数やプロパティそしてメソッドへの間接的なアクセスを、厳密に左から右の順で評価するようになりました。 以前のバージョンでは、場合によって評価の順が逆転することもありました。
   - 今までのバージョンにおける右から左の評価を想定しているコードは、 波括弧を使って評価順を明示するように (表の中央列のように) 書き直す必要があります。
 * list() の取り扱いの変更
   - list() での変数の代入が、逆順ではなくなる
   - 一般論として、 list() での代入がどの順で行われるかに依存するコードは書かないことを推奨します。 
 * 空の list() の廃止
   - 空の list() を作ることはできなくなりました。
 * list() は文字列を展開しない
   - かわりに str_split() を使いましょう。
 * 参照による代入で自動的に作成した配列要素の並び順の変更
 * global は単純な変数だけを受け付ける
 * 関数のパラメータを括弧で囲んでもその振る舞いは変わらない

* foreach の変更
 * foreach は内部の配列ポインタを変更しない
 * 値渡しの foreach は、配列のコピーを使って操作を進める
 * 参照渡しの foreach の、反復処理の振る舞いを改良
 * Traversable でないオブジェクトの反復処理

* integer の取り扱いの変更
 * 無効な形式の八進リテラル
 * 負のビットシフト
 * 範囲外のビットシフト
 * ゼロ除算の挙動の変更
  - 以前のバージョンでは、除算演算子 (/) や剰余演算子 (%) の除数に 0 を使うと、E_WARNING が発生して結果は false となっていました。 PHP 7 では、除算演算子の返す結果は float で、 +INF、-INF あるいは NAN のいずれかとなります。 これは、IEEE 754 で指定された挙動です。 剰余演算子については E_WARNING が発生しなくなり、 DivisionByZeroError 例外をスローするようになりました。

* 文字列の取り扱いの変更
 * 十六進数値形式の文字列は数値とはみなさない
 * \u{ がエラーの原因になることがある

* 削除された関数
 * call_user_method() および call_user_method_array()
 * ereg* 系のすべての関数
   - ereg 関数はすべて削除されました。かわりに PCRE を使うことを推奨します。
 * mcrypt のエイリアス
   - 非推奨の mcrypt_generic_end() 関数が削除されました。 かわりに mcrypt_generic_deinit() を使いましょう。
 * すべての ext/mysql 関数
 * すべての ext/mssql 関数
 * intl のエイリアス
 * set_magic_quotes_runtime()
 * set_socket_blocking()
 * PHP-FPM における dl()
 * GD Type1 関数群

* 削除された INI 項目
 * always_populate_raw_post_data
 * asp_tags

* 下位互換性のないその他の変更
 * 新しいオブジェクトを参照渡しで代入できない
 * 無効なクラス名、インターフェイス名、トレイト名
 * ASP タグと script タグの廃止
 * 非互換のコンテキストからの呼び出しの削除
 * yield が右代入演算子に
 * 同じ名前のパラメータをひとつの関数に複数定義できない
 * 引数を調べる関数は、パラメータの その時点での 値を報告する
 * Switch 文に複数の default ブロックを書けない
 * $HTTP_RAW_POST_DATA の削除
 * INI ファイルにおける # 形式のコメントの削除
 * JSON 拡張モジュールが JSOND に置き換わる
 * 内部関数がオーバーフローしたときの挙動
 * カスタムセッションハンドラの戻り値の修正
 * 同値な要素の並び順

---

## PHP 7.0.x で推奨されなくなる機能

---

## 変更された関数

---

## 削除された拡張モジュールおよび SAPI

---

## その他の変更

---

## 所感
* 

